<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:form id="saleForm" style="overflow-y: scroll; margin: 80px auto;">

    <script type="application/javascript">
        $('#saleForm').on('keydown', 'input', function (event) {
            if (event.which == 13) {
                event.preventDefault();
                var $this = $(event.target);
                var index = parseFloat($this.attr('tabindex'));
                $('[tabindex="' + (index + 1).toString() + '"]').focus().select();
            }
        });

        function funcForWindowPopup()
        {
            var popup = null;
            popup = window.open("buyers_no_menu.xhtml", "popup", "toolbar=no,menubar=no,scrollbars=yes,location=no,left=350,top=50,width=1200, height=768");
            popup.openerFormId = "vendorForm";
            popup.focus();
        }

    </script>
    <style type="text/css">
    </style>
    <p:panel header="Vásárlások" id="salePanel" toggleable="true"   >
        <div class="card">

            <p:panelGrid columns="3" contentStyle="margin: 0; padding: 0; line-height: 21px;"
                         columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4"
                         layout="grid"
                         styleClass="ui-panelgrid-blank ui-fluid "
                         style="border:0 none; padding: 0; width: 100%;">
                <p:divider >
                    <p:remoteCommand update="buyer" name="updateBuyer"/>
                    <p:outputLabel for="buyer" value="Eladó neve: "/><p:commandButton style="margin-left: 5px; font-size: 0.8em; width: 4em; height: 3em" value="Új"  onclick="funcForWindowPopup()"/><br/>
                    <p:selectOneMenu required="true" id="buyer" value="#{saleController.dto.buyer}"  converter="#{buyerConverter}"  filter="true" filterMatchMode="contains">
                        <f:selectItem itemValue="#{null}" itemLabel="Válasszon" noSelectionOption="true" />
                        <f:selectItems value="#{buyerController.dtoList}" var="buyervar" itemLabel="#{buyervar.name}(#{buyervar.accountNum})" itemValue="#{buyervar}" />
                        <p:ajax event="change" listener="#{saleController.updateAccountNum()}" update="accountnumber"/>
                    </p:selectOneMenu><br/>
                    <p:outputLabel for="currency" value="Fizetési valuta:"/><br/>
                    <p:selectOneMenu id="currency" value="#{saleController.dto.currency}" required="true" style="max-width: 120px" editable="true" ><br/>
                        <f:selectItem itemLabel="HUF" itemValue="HUF"/>
                        <f:selectItem itemLabel="EUR" itemValue="EUR"/>
                        <f:selectItem itemLabel="USD" itemValue="USD"/>
                        <f:selectItem itemLabel="PLN" itemValue="PLN"/>
                        <f:selectItem itemLabel="RON" itemValue="RON"/>
                        <f:selectItem itemLabel="GBP" itemValue="GBP"/>
                        <f:selectItem itemLabel="CZK" itemValue="CZK"/>
                        <f:selectItem itemLabel="AUD" itemValue="AUD"/>
                        <f:selectItem itemLabel="SEK" itemValue="SEK"/>
                        <f:selectItem itemLabel="NOK" itemValue="NOK"/>
                        <f:selectItem itemLabel="TRY" itemValue="TRY"/>
                    </p:selectOneMenu><br/>
                    <p:outputLabel for="sum" value="kifizetendő:"/><br/>
                    <p:inputText id="sum" value="#{saleController.dto.price}" required="true" /><br/>


                </p:divider>
                <p:divider>

                    <p:outputLabel for="bookingdate" value="Felv.jegy dátuma:"/><br/>
                    <p:inputMask mask="9999.99.99" id="bookingdate" value="#{saleController.dto.bookingDate}">
                        <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
                    </p:inputMask>

                    <p:outputLabel for="accountnumber" value="Számlaszám: "/><h:message for="saleForm:accountnumber" style="color:red"/><br/>
                    <p:inputMask mask="99999999-99999999-99999999" id="accountnumber"  value="#{saleController.dto.accountNumber}" validatorMessage="Rossz formátum">
                        <f:validateRegex pattern="^\d{8}-\d{8}-\d{8}$"/>
                    </p:inputMask><p/>
                    <p:outputLabel id="error" value="#{saleController.errorMessage}" style="color:red;"/><br/>
                    <h:commandButton value="#{saleController.label}"
                                     action="#{saleController.uiSaveSale}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax execute="saleForm:salePanel" render="saleList saleForm:error salePanel saleForm:productList saleForm:fixProductPanel" />
                    </h:commandButton>

                    <h:commandButton value="Új"
                                     action="#{saleController.newSale}"
                                     style="width: 10em;height: 2.6em">
                        <p:resetInput target="saleForm:salePanel"/>
                        <f:ajax execute="saleForm:salePanel" render="saleList saleForm:productList saleForm:fixProductPanel" />
                        <p:ajax update="saleForm:salePanel"/>
                    </h:commandButton>
                    <h:commandButton value="Töröl"
                                     action="#{saleController.deleteSale}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax execute="saleForm:SalePanel" render="saleList salePanel saleForm:fixProductPanel saleForm:productList" />
                    </h:commandButton><p/>
                </p:divider>

            </p:panelGrid>

        </div>
    </p:panel>
    <p:panel header="Termékek" id="fixProductPanel" toggleable="true"  collapsed="false" >


            <table border="1px" style="border-collapse: collapse">
                <thead>
                <tr>
                    <th>
                        <p:outputLabel value="Minősítés:"/><p/>
                    </th>
                    <th>
                        <p:outputLabel  value="Mennyiségenkénti ár:" /><br/>
                    </th>
                    <th>
                        <p:outputLabel value="Nettó súly(kg):"/><br/>
                    </th>

                </tr>
                </thead>
                <tbody>
                <tr>
                    <td> <p:outputLabel id="prod1" value="#{saleController.one.product.id}"  /><br/></td>
                    <td>   <p:inputText id="unitPrice1" value="#{saleController.one.unitPrice}" required="false" tabindex="55" >
                        <p:ajax event="keyup" />
                    </p:inputText><br/></td>
                    <td>   <p:inputText id="nquantity1" value="#{saleController.one.quantity}" required="false" tabindex="61">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>
                <tr>
                    <td> <p:outputLabel id="prod2" value="#{saleController.two.product.id}" /><br/> </td>
                    <td> <p:inputText id="unitPrice2" value="#{saleController.two.unitPrice}" required="false" tabindex="56">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                    <td> <p:inputText id="nquantity2" value="#{saleController.two.quantity}" required="false" tabindex="62">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>
                <tr>
                    <td> <p:outputLabel id="prod3" value="#{saleController.three.product.id}"   /><br/></td>
                    <td>    <p:inputText id="unitPrice3" value="#{saleController.three.unitPrice}" required="false" tabindex="57">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                    <td>  <p:inputText id="nquantity3" value="#{saleController.three.quantity}" required="false" tabindex="63" >
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>
                <tr>
                    <td><p:outputLabel id="prod4" value="#{saleController.four.product.id}"   /><br/></td>
                    <td>  <p:inputText id="unitPrice4" value="#{saleController.four.unitPrice}" required="false"  tabindex="58">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                    <td><p:inputText id="nquantity4" value="#{saleController.four.quantity}" required="false" tabindex="64" >
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>
                <tr>
                    <td> <p:outputLabel id="prod5" value="#{saleController.five.product.id}"  /><br/></td>
                    <td> <p:inputText id="unitPrice5" value="#{saleController.five.unitPrice}" required="false" tabindex="59">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                    <td> <p:inputText id="nquantity5" value="#{saleController.five.quantity}" required="false" tabindex="65">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>
                <tr>
                    <td>   <p:outputLabel id="prod6" value="#{saleController.six.product.id}"  /></td>
                    <td> <p:inputText id="unitPrice6" value="#{saleController.six.unitPrice}" required="false" tabindex="60"  >
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                    <td><p:inputText id="nquantity6" value="#{saleController.six.quantity}" required="false"  tabindex="66">
                        <p:ajax event="keyup"  />
                    </p:inputText><br/></td>
                </tr>

                </tbody>
            </table>

                    <h:commandButton value="Mentés"
                                     action="#{saleController.sixSave}"
                                     style="width: 14em;height: 2.6em">
                        <f:ajax execute="saleForm:fixProductPanel" render="saleForm:fixProductPanel saleForm:productList" />
                    </h:commandButton>





    </p:panel>

    <p:dataTable var="product" value="#{saleController.dto.productList}" id="productList"
                 lazy="false" style="overflow-x: scroll; margin-bottom: 5em" scrollable="true" scrollWidth="100%"
                 selectionMode="single" emptyMessage="Nincs termék" resizableColumns="true"
                 selection="#{saleController.productDTO}" rowKey="#{product.id}">
        <p:ajax event="rowSelect"  listener="#{saleController.editProduct}" />
        <p:column headerText="Termék neve" filterBy="#{product.product.id}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.product.id}" id="did"/>
        </p:column>
        <p:column headerText="Mennyiség"  filterBy="#{product.quantity}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.quantity}"/>
        </p:column>
        <p:column headerText="Egységár"  filterBy="#{product.unitPrice}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.unitPrice}"/>
        </p:column>
    </p:dataTable>




    <p:dataTable var="sale" value="#{saleController.dtoList}" id="saleList"
                 lazy="false" sortBy="#{saleController.sortBy}" sortMode="single"
                 allowUnsorting="true" style="overflow-x: scroll; margin-bottom: 5em" scrollable="true" scrollWidth="100%"
                 selectionMode="single" emptyMessage="Nincs találat" resizableColumns="true"
                 selection="#{saleController.dto}" rowKey="#{sale.id}">
        <p:ajax event="rowSelect"  listener="#{saleController.editSale}" update="saleForm:salePanel saleForm:productList saleForm:fixProductPanel"/>
        <p:column headerText="Sorszám" sortBy="#{sale.id}" filterBy="#{sale.id}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{sale.id}" id="id"/>
        </p:column>
        <p:column headerText="Eladó neve" sortBy="#{sale.buyer.name}" filterBy="#{sale.buyer.name}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{sale.buyer.name}"/>
        </p:column>


        <p:column headerText="Számla kelt" sortBy="#{sale.bookingDate}" filterBy="#{sale.bookingDate}" filterMatchMode="contains" width="4.5em" >
            <h:outputText value="#{sale.bookingDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Fiz. valuta" sortBy="#{sale.currency}" filterBy="#{sale.currency}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{sale.currency}"/>
        </p:column>
        <p:column headerText="Vételár" sortBy="#{sale.price}" filterBy="#{sale.price}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{sale.price}"/>
        </p:column>
    </p:dataTable>
</h:form>
</html>




