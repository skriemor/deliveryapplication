<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:form id="purchaseForm" style="overflow-y: scroll; margin: 80px auto;">
    <style type="text/css">
    </style>
    <p:panel header="Vásárlások" id="purchasePanel" toggleable="true"   >
        <div class="card">

            <p:panelGrid columns="3" contentStyle="margin: 0px; padding: 0px; line-height: 21px;"
                         columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4"
                         layout="grid"
                         styleClass="ui-panelgrid-blank ui-fluid "
                         style="border:0px none; padding: 0px; width: 100%;">
                <p:divider >

                    <p:outputLabel for="vendor" value="Eladó neve: "/><br/>
                    <p:selectOneMenu id="vendor" value="#{purchaseController.dto.vendor}"  converter="#{vendorConverter}"  filter="true" filterMatchMode="contains">
                        <f:selectItems value="#{vendorController.dtoList}" var="vendorvar" itemLabel="#{vendorvar.vendorName}(#{vendorvar.city})" itemValue="#{vendorvar}" />
                    </p:selectOneMenu><br/>

                    <p:outputLabel for="site" value="Telephely: "/><br/>
                    <p:selectOneMenu id="site" value="#{purchaseController.dto.site}"  converter="#{siteConverter}"  filter="true" filterMatchMode="contains">
                        <f:selectItems value="#{siteController.dtoList}" var="sitevar" itemLabel="#{sitevar.siteName}" itemValue="#{sitevar}"/>
                    </p:selectOneMenu><br/>
                    <p:outputLabel for="note" value="Megjegyzés:"/><br/>
                    <p:inputText id="note" value="#{purchaseController.dto.notes}" required="false" /><br/>



                </p:divider>
                <p:divider>
                    <p:outputLabel for="completiondate" value="Teljesítés dátuma:"/><br/>
                    <p:datePicker id="completiondate"  value="#{purchaseController.dto.completionDate}" monthNavigator="true" yearRange="#{purchaseController.dateRange}" yearNavigator="true" required="true" pattern="yyyy.MM.dd" /><br/>
                    <p:outputLabel for="ticketdate" value="Felv.jegy dátuma:"/><br/>
                    <p:datePicker id="ticketdate"  value="#{purchaseController.dto.ticketDate}" monthNavigator="true" yearRange="#{purchaseController.dateRange}" yearNavigator="true" required="true" pattern="yyyy.MM.dd" /><br/>
                    <p:outputLabel for="paymentdate" value="Felv.jegy dátuma:"/><br/>
                    <p:datePicker id="paymentdate"  value="#{purchaseController.dto.receiptDate}" monthNavigator="true" yearRange="#{purchaseController.dateRange}" yearNavigator="true" required="true" pattern="yyyy.MM.dd" /><br/>
                </p:divider>
                <p:divider>
                    <p:outputLabel for="method" value="Fizetési mód:"/><br/>
                    <p:selectOneMenu id="method" value="#{purchaseController.dto.paymentMethod}" required="true" style="max-width: 120px" ><br/>
                        <f:selectItem itemLabel="Készpénz" itemValue="Készpénz"/>
                        <f:selectItem itemLabel="Átutalás" itemValue="Átutalás"/>
                    </p:selectOneMenu><p/>
                    <h:commandButton value="#{purchaseController.label}"
                                     action="#{purchaseController.uiSavePurchase}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax execute="purchaseForm:purchasePanel" render="purchaseList purchasePanel purchaseForm:productList" />
                    </h:commandButton>

                    <h:commandButton value="Új"
                                     action="#{purchaseController.newPurchase}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax execute="purchaseForm:purchasePanel" render="purchaseList purchasePanel purchaseForm:productList" />
                    </h:commandButton>
                    <h:commandButton value="Töröl"
                                     action="#{purchaseController.deletePurchase}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax execute="purchaseForm:PurchasePanel" render="purchaseList purchasePanel purchaseForm:fixProductPanel purchaseForm:productList" />
                    </h:commandButton><p/>
                    <p:commandButton value="Letöltés excelként" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);"
                                     icon="pi pi-arrow-down" styleClass="mr-2" actionListener="#{purchaseController.pdf()}">
                        <p:fileDownload value="#{purchaseController.file}"/>
                    </p:commandButton>
                </p:divider>

            </p:panelGrid>

        </div>
    </p:panel>
    <p:panel header="Termékek" id="fixProductPanel" toggleable="true"  collapsed="false" >
        <div class="card">

            <p:panelGrid columns="6" contentStyle="margin: 0px; padding: 0px; line-height: 21px;"
                         columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2, ui-grid-col-2, ui-grid-col-2, ui-grid-col-2"
                         layout="grid"
                         styleClass="ui-panelgrid-blank ui-fluid "
                         style="border:0px none; padding: 0px; width: 100%; overflow-x: scroll">
                <p:divider >
                    <p:outputLabel for="prod1" value="Termék:"/><br/>
                    <p:outputLabel id="prod1" value="#{purchaseController.one.product.id}" style="font-size: 2em;" /><br/>


                    <p:outputLabel for="nquantity1" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity1" value="#{purchaseController.one.quantity}" required="false"   >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice1" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice1" value="#{purchaseController.one.unitPrice}" required="false" rendered="#{purchaseController.disableedit}" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr1" value="Korrekció %:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="corr1" value="#{purchaseController.one.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                </p:divider>
                <p:divider>
                    <p:outputLabel for="prod2" value="Termék:"/><br/>
                    <p:outputLabel id="prod2" value="#{purchaseController.two.product.id}" style="font-size: 2em;" /><br/>
                    <p:outputLabel for="nquantity2" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity2" value="#{purchaseController.two.quantity}" required="false" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice2" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice2" value="#{purchaseController.two.unitPrice}" required="false" rendered="#{purchaseController.disableedit}" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr2" value="Korrekció %:" rendered="#{purchaseController.disableedit}" /><br/>
                    <p:inputText id="corr2" value="#{purchaseController.two.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                </p:divider>
                <p:divider>
                    <p:outputLabel for="prod3" value="Termék:"/><br/>
                    <p:outputLabel id="prod3" value="#{purchaseController.three.product.id}" style="font-size: 2em;" /><br/>


                    <p:outputLabel for="nquantity3" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity3" value="#{purchaseController.three.quantity}" required="false" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice3" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice3" value="#{purchaseController.three.unitPrice}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr3" value="Korrekció %:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="corr3" value="#{purchaseController.three.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>


                </p:divider>
                <p:divider>
                    <p:outputLabel for="prod4" value="Termék:"/><br/>
                    <p:outputLabel id="prod4" value="#{purchaseController.four.product.id}" style="font-size: 2em;" /><br/>


                    <p:outputLabel for="nquantity4" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity4" value="#{purchaseController.four.quantity}" required="false" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice4" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice4" value="#{purchaseController.four.unitPrice}" required="false" rendered="#{purchaseController.disableedit}" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr4" value="Korrekció %:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="corr4" value="#{purchaseController.four.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>



                </p:divider>
                <p:divider>
                    <p:outputLabel for="prod5" value="Termék:"/><br/>
                    <p:outputLabel id="prod5" value="#{purchaseController.five.product.id}" style="font-size: 2em;" /><br/>


                    <p:outputLabel for="nquantity5" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity5" value="#{purchaseController.five.quantity}" required="false" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice5" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice5" value="#{purchaseController.five.unitPrice}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr5" value="Korrekció %:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="corr5" value="#{purchaseController.five.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>


                </p:divider>
                <p:divider>
                    <p:outputLabel for="prod6" value="Termék:"/><br/>
                    <p:outputLabel id="prod6" value="#{purchaseController.six.product.id}" style="font-size: 2em;" /><br/>


                    <p:outputLabel for="nquantity6" value="Bruttó mennyiség:"/><br/>
                    <p:inputText id="nquantity6" value="#{purchaseController.six.quantity}" required="false" >
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>

                    <p:outputLabel for="unitPrice6" value="Mennyiségenkénti ár:" rendered="#{purchaseController.disableedit}"/><br/>
                    <p:inputText id="unitPrice6" value="#{purchaseController.six.unitPrice}" required="false"  rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>
                    <p:outputLabel for="corr6" value="Korrekció %:" rendered="#{purchaseController.disableedit}" /><br/>
                    <p:inputText id="corr6" value="#{purchaseController.six.corrPercent}" required="false" rendered="#{purchaseController.disableedit}">
                        <p:ajax event="keyup" update="totalPricePerProduct1" />
                    </p:inputText><br/>


                </p:divider>
                <p:divider>
                    <p:outputLabel id="totalPricePerProduct1" value="Termékek részösszesített ára: #{purchaseController.sixTotal} HUF" /><p/>
                    <h:commandButton value="Hozzáadás / Mentés"
                                     action="#{purchaseController.sixSave}"
                                     style="width: 14em;height: 2.6em">
                        <f:ajax execute="purchaseForm:fixProductPanel" render="purchaseForm:fixProductPanel purchaseForm:productList" />
                    </h:commandButton>


                    <h:commandButton value="Árak/korrekciók szerkesztése"
                                     action="#{purchaseController.enableEdit()}"
                                     style="width: 14em;height: 2.6em">
                        <f:ajax execute="purchaseForm:fixProductPanel" render="purchaseForm:fixProductPanel" />
                    </h:commandButton>
                </p:divider>

            </p:panelGrid>

        </div>
    </p:panel>
    <p:panel header="Termékek Módosítása" id="productPanel" toggleable="true"  collapsed="false">
        <div class="card">

            <p:panelGrid columns="3" contentStyle="margin: 0px; padding: 0px; line-height: 21px;"
                         columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4"
                         layout="grid"
                         styleClass="ui-panelgrid-blank ui-fluid "
                         style="border:0px none; padding: 0px; width: 100%;">



                    <h:commandButton value="Termékek törlése"
                                     action="#{purchaseController.deleteProduct}"
                                     style="width: 10em;height: 2.6em">
                        <f:ajax  render="productList productPanel" />
                    </h:commandButton>

            </p:panelGrid>

        </div>
    </p:panel>
    <p:dataTable var="product" value="#{purchaseController.dto.productList}" id="productList"
                 lazy="false" style="overflow-x: scroll; margin-bottom: 5em" scrollable="true" scrollWidth="100%"
                 selectionMode="single" emptyMessage="Nincs termék" resizableColumns="true"
                 selection="#{purchaseController.productDTO}" rowKey="#{product.id}">
        <p:ajax event="rowSelect"  listener="#{purchaseController.editProduct}" update="purchaseForm:productPanel"/>
        <p:column headerText="Termék neve" filterBy="#{product.product.id}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.product.id}" id="did"/>
        </p:column>
        <p:column headerText="Mennyiség"  filterBy="#{product.quantity}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.quantity}"/>
        </p:column>
        <p:column headerText="Egységár"  filterBy="#{product.unitPrice}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{product.unitPrice}"/>
        </p:column>

    </p:dataTable>




    <p:dataTable var="purchase" value="#{purchaseController.dtoList}" id="purchaseList"
                 lazy="false" sortBy="#{purchaseController.sortBy}" sortMode="single"
                 allowUnsorting="true" style="overflow-x: scroll; margin-bottom: 5em" scrollable="true" scrollWidth="100%"
                 selectionMode="single" emptyMessage="Nincs találat" resizableColumns="true"
                 selection="#{purchaseController.dto}" rowKey="#{purchase.id}">
        <p:ajax event="rowSelect"  listener="#{purchaseController.editPurchase}" update="purchaseForm:purchasePanel purchaseForm:productPanel purchaseForm:productList"/>
        <p:column headerText="Sorszám" sortBy="#{purchase.id}" filterBy="#{purchase.id}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.id}" id="id"/>
        </p:column>
        <p:column headerText="Eladó neve" sortBy="#{purchase.vendor.vendorName}" filterBy="#{purchase.vendor.vendorName}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.vendor.vendorName}"/>
        </p:column>
        <p:column headerText="Helység" sortBy="#{purchase.vendor.city}" filterBy="#{purchase.vendor.city}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.vendor.city}"/>
        </p:column>
        <p:column headerText="Telephely" sortBy="#{purchase.site.siteName}" filterBy="#{purchase.site.siteName}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.site.siteName}"/>
        </p:column>
        <p:column headerText="Telj. dátum" sortBy="#{purchase.completionDate}" filterBy="#{purchase.completionDate}" filterMatchMode="contains" width="4.5em" >
            <h:outputText value="#{purchase.completionDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Számla kelt" sortBy="#{purchase.ticketDate}" filterBy="#{purchase.ticketDate}" filterMatchMode="contains" width="4.5em" >
            <h:outputText value="#{purchase.ticketDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Fiz határidő" sortBy="#{purchase.receiptDate}" filterBy="#{purchase.receiptDate}" filterMatchMode="contains" width="4.5em" >
            <h:outputText value="#{purchase.receiptDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Fiz. mód" sortBy="#{purchase.paymentMethod}" filterBy="#{purchase.paymentMethod}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.paymentMethod}"/>
        </p:column>
        <p:column headerText="Vételár" sortBy="#{purchase.totalPrice}" filterBy="#{purchase.totalPrice}" filterMatchMode="contains" width="5em" >
            <h:outputText value="#{purchase.totalPrice}"/>
        </p:column>
        <p:column headerText="Rögz. dátum" sortBy="#{purchase.bookedDate}" filterBy="#{purchase.bookedDate}" filterMatchMode="contains" width="4.5em" >
            <h:outputText value="#{purchase.bookedDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
    </p:dataTable>
</h:form>
</html>




