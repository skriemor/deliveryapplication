<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:p="http://primefaces.org/ui">

<h:form id="purchaseForm" style="overflow-y: scroll; margin: 80px auto;">
    <script type="application/javascript">
        $('#purchaseForm').on('keydown', 'input', function (event) {
            if (event.which == 13) {
                event.preventDefault();
                var $this = $(event.target);
                var index = parseFloat($this.attr('tabindex'));
                if (index == 13) {
                    $('[tabindex=14]').click();
                    index = 7;
                }
                $('[tabindex="' + (index + 1).toString() + '"]').focus().select();

            }
        });


        function funcForWindowPopup() {
            var popup = null;
            popup = window.open("vendors_no_menu.xhtml", "popup", "toolbar=no,menubar=no,scrollbars=yes,location=no,left=350,top=50,width=1200, height=768");
            popup.openerFormId = "vendorForm";
            popup.focus();
        }

        function funcForWindowPopup2() {
            var popup = null;
            popup = window.open("sites_no_menu.xhtml", "popup", "toolbar=no,menubar=no,scrollbars=yes,location=no,left=350,top=50,width=1200, height=768");
            popup.openerFormId = "vendorForm";
            popup.focus();

        }


    </script>
    <style type="text/css">

        body .ui-datatable .ui-datatable-data > tr > td {
            padding: 0.3rem 0.3rem;
            border: 1px solid rgba(0,0,0,.08);
            border-top-width: 1px;
            border-right-width: 1px;
            border-bottom-width: 1px;
            border-left-width: 1px;
            border-width: 0 0 1px 0;
        }

    </style>

    <p:tabView id="cPTabs">

        <p:tab menuTitle="Felvásárlási jegyek" title="Felvásárlási jegyek">

            <p:panel header="Felvásárlási jegyek" id="purchasePanelV" toggleable="true">
            <div class="card">

                <p:panelGrid columns="3" contentStyle="margin: 0; padding: 0; line-height: 21px;"
                             columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4"
                             layout="grid"
                             styleClass="ui-panelgrid-blank ui-fluid "
                             style="border:0 none; padding: 0; width: 100%;">
                    <p:divider>
                        <p:outputLabel for="vendorv" value="Eladó neve: " style="font-weight: bold;"/>
                        <p:outputLabel id="vendorv" value="#{completedPurchaseController.dto.vendor.vendorName}"/>
                        <p/>

                        <p:outputLabel for="sitev" value="Telephely: " style="font-weight: bold;"/>
                        <p:outputLabel id="sitev" value="#{completedPurchaseController.dto.site.siteName}" />
                           <p/>
                        <p:outputLabel for="paymentMethodv" value="Fizetési mód: " style="font-weight: bold;"/>
                        <p:outputLabel id="paymentMethodv" value="#{completedPurchaseController.dto.paymentMethod}"/>

                    </p:divider>
                    <p:divider>
                        <p:outputLabel for="serialv" value="Felvásárlási jegy sorszáma: " style="font-weight: bold;"/>
                        <p:outputLabel id="serialv" value="#{completedPurchaseController.dto.newSerial}"/> <p/>
                        <p:outputLabel for="receiptDatev" value="Felvásárlási jegy dátuma: " style="font-weight: bold;"/>
                        <p:outputLabel mask="9999.99.99" id="receiptDatev"
                                       value="#{completedPurchaseController.toDottedDate(completedPurchaseController.dto.receiptDate)}"/><p/>


                        <p:outputLabel for="paymentDatev" value="Fizetés dátuma: " style="font-weight: bold;"/>
                        <p:outputLabel mask="9999.99.99" id="paymentDatev"
                                     value="#{completedPurchaseController.toDottedDate(completedPurchaseController.dto.paymentDate)}"/><p/>

                    </p:divider>

                </p:panelGrid>

            </div>

            </p:panel>


            <hr></hr>

            <p/>

            <p:panel header="Felvásárlási jegy" id="cPPanel" toggleable="true" collapsed="false">

                <table border="1px" style="border-collapse: collapse; overflow-x: scroll; scroll-behavior: smooth;">
                    <thead>
                    <tr>
                        <th colspan="3">
                            <p:outputLabel value="Minősítés:"/>
                            <p/>
                        </th>
                        <th>
                            <p:outputLabel value="Súly(kg):"/><br/>
                        </th>
                        <th>
                            <p:outputLabel value="Kifizetendő bruttó:"/><br/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod1"  value="I.OSZTÁLYÚ"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="snquantity1" value="#{completedPurchaseController.getTotalAmountOf(0)}"/><br/>
                        </td>
                        <td align="center" rowspan="7" style="vertical-align: bottom">
                            <p:outputLabel style="font-size: 1.5em" id="stotalPricePerProduct1"
                                           value="#{completedPurchaseController.sumOfRecordPrices} HUF"/>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod2" value="II.OSZTÁLYÚ"/><br/>
                        </td>


                        <td>
                            <p:outputLabel id="snquantity2" value="#{completedPurchaseController.getTotalAmountOf(1)}"/><br/>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod3" value="III.OSZTÁLYÚ"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="snquantity3" value="#{completedPurchaseController.getTotalAmountOf(2)}"/><br/>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod4" value="IV.OSZTÁLYÚ"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="snquantity4" value="#{completedPurchaseController.getTotalAmountOf(3)}"/><br/>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod5" value="GYÖKÉR"/><br/>
                        </td>

                        <td>
                            <p:outputLabel id="snquantity5" value="#{completedPurchaseController.getTotalAmountOf(4)}"/><br/>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="3">
                            <p:outputLabel id="sprod6" value="IPARI"/>
                        </td>
                        <td><p:outputLabel id="snquantity6" value="#{completedPurchaseController.getTotalAmountOf(5)}">
                        </p:outputLabel><br/></td>
                    </tr>
                    <tr>
                        <td colspan="3"><p:outputLabel value="Összesen:"/></td>

                        <td align="center"><p:outputLabel style="font-size: 1.5em" id="stotalNet"
                                                          value="#{ completedPurchaseController.getDtoWeight()} kg"/></td>

                    </tr>
                    <tr>
                        <td><p:outputLabel value="Átlagár br."/></td>

                        <td align="center"><p:outputLabel style="font-size: 1em" id="netAvgPriceV"
                                                          value="&nbsp;&nbsp;&nbsp;#{completedPurchaseController.getFormattedNumber(completedPurchaseController.netTotalV)}&nbsp;&nbsp;&nbsp;"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="diffV"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.diffV)}"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="grossAvgPriceV"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.getGrossAvgPriceV())}"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="grossTotalV"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.grossTotalV)}"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel value="Átlagár net."/></td>
                        <td></td>
                        <td></td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="netAvgV"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.netAvgPriceV)}"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p/>
            </p:panel>
            <p:dataTable var="record" value="#{completedPurchaseController.tempRecords}" id="recordList2"
                         lazy="false" tableStyle="width: auto"
                         style="overflow-x: scroll; margin-bottom: 5em"
                         emptyMessage="Nincs rekord" resizableColumns="true">

                <p:column headerText="Mérlegelés sorszáma">
                    <h:outputText value="#{record.purchaseId}"/>
                </p:column>
                <p:column headerText="Ár">
                    <h:outputText value="#{record.formattedPrice} HUF"/>
                </p:column>
                <p:column headerText="I.OSZT">
                    <h:outputText value="#{record.one}"/>
                </p:column>
                <p:column headerText="II.OSZT">
                    <h:outputText value="#{record.two}"/>
                </p:column>
                <p:column headerText="III.OSZT">
                    <h:outputText value="#{record.three}"/>
                </p:column>
                <p:column headerText="IV.OSZT">
                    <h:outputText value="#{record.four}"/>
                </p:column>
                <p:column headerText="GYÖKÉR">
                    <h:outputText value="#{record.five}"/>
                </p:column>
                <p:column headerText="IPARI">
                    <h:outputText value="#{record.six}"/>
                </p:column>
            </p:dataTable>

            <p:panel id="buttonPanel2">
                <h:commandButton value="Kiválasztott törlése"
                                 action="#{completedPurchaseController.deletePurchase}"
                                 style="width: 10em;height: 2.6em">
                    <f:ajax execute="purchaseForm:cPTabs:PurchasePanel purchaseForm:cPTabs:purchasePanelV"
                            render="purchaseList purchasePanel purchaseForm:cPTabs:purchasePanelV  purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2 totalDisplay purchaseForm:cPTabs:pur"/>
                </h:commandButton>
                <p/>

            </p:panel>


        </p:tab>
        <p:tab title="Új felvásárlási jegy">
            <p:outputLabel for="pur" value="Felhasználható mérlegelési jegyek:"/><br/>
            <p:selectOneMenu id="pur" value="#{completedPurchaseController.purchaseDTO}" tabindex="1"
                             converter="#{purchaseConverter}" filter="true" filterMatchMode="contains">
                <!--<p:ajax event="itemSelect" update="fixProductPanel" listener="#{completedPurchaseController.onItemSelectedListener}"/>-->
                <p:ajax event="change" update="fixProductPanel"
                        listener="#{completedPurchaseController.logRecordList()}"/>
                <f:selectItem itemValue="#{null}" itemLabel="Válasszon" noSelectionOption="true"/>
                <f:selectItems value="#{completedPurchaseController.getAvailablePurchases()}" var="purchasevar"
                               itemLabel="#{purchasevar.id} (#{purchasevar.vendor.vendorName}, #{completedPurchaseController.getFormattedNumber(purchasevar.remainingPrice)} HUF)"
                               itemValue="#{purchasevar}"/>
            </p:selectOneMenu><br/>
            <p:panel header="Felvásárlási jegyek" id="purchasePanel" toggleable="true">
                <div class="card">

                    <p:panelGrid columns="3" contentStyle="margin: 0; padding: 0; line-height: 21px;"
                                 columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4"
                                 layout="grid"
                                 styleClass="ui-panelgrid-blank ui-fluid "
                                 style="border:0 none; padding: 0; width: 100%;">
                        <p:divider>
                            <p:remoteCommand name="updateVendor"
                                             update="vendor v1 v2 v3 v4 v5 v6 v7 v8 v9 v10 v11 v12 v13 v14 v15 v16"/>
                            <p:remoteCommand name="updateSite" update="site"/>


                            <p:outputLabel for="vendor" value="Eladó neve: "/><p:commandButton
                                style="margin-left: 5px; font-size: 0.8em; width: 4em; height: 3em" value="Új"
                                onclick="funcForWindowPopup()"/><br/>
                            <p:selectOneMenu id="vendor" value="#{completedPurchaseController.dto.vendor}"
                                             required="true" tabindex="2"
                                             converter="#{vendorConverter}" filter="true" filterMatchMode="contains">
                                <p:ajax event="change" update="purchaseForm:cPTabs:purchasePanelV v1 v2 v3 v4 v5 v6 v7 v8 v9 v10 v11 v12 v13 v14 v15 v16"/>
                                <p:ajax event="select" listener="#{vendorServiceImpl.allVendors}"
                                        update="purchaseForm:cPTabs:purchasePanelV vendor v1 v2 v3 v4 v5 v6 v7 v8 v9 v10 v11 v12 v13 v14 v15 v16"/>
                                <f:selectItem itemValue="#{null}" itemLabel="Válasszon" noSelectionOption="true"/>
                                <f:selectItems value="#{vendorServiceImpl.allVendors}" var="vendorvar"
                                               itemLabel="#{vendorvar.vendorName}(#{vendorvar.birthPlace}, #{vendorvar.formattedBirthDate})"
                                               itemValue="#{vendorvar}"/>
                            </p:selectOneMenu><br/>

                            <p:outputLabel for="site" value="Telephely: "/><p:commandButton
                                style="margin-left: 5px; font-size: 0.8em; width: 4em; height: 3em" value="Új"
                                onclick="funcForWindowPopup2()"/><br/>
                            <p:selectOneMenu id="site" value="#{completedPurchaseController.dto.site}" required="true"
                                             tabindex="3"
                                             converter="#{siteConverter}" filter="true" filterMatchMode="contains">
                                <p:ajax event="change" update="purchaseForm:cPTabs:purchasePanelV"/>
                                <p:ajax event="select" update="purchaseForm:cPTabs:purchasePanelV"/>
                                <f:selectItems value="#{siteController.dtoList}" var="sitevar"
                                               itemLabel="#{sitevar.siteName}"
                                               itemValue="#{sitevar}"/>
                            </p:selectOneMenu><br/>
                            <p:outputLabel for="paymentMethod" value="Fizetési mód: "/>
                            <br/>
                            <p:selectOneMenu id="paymentMethod" value="#{completedPurchaseController.dto.paymentMethod}"
                                             required="true" tabindex="4">
                                <p:ajax event="change" update="purchaseForm:cPTabs:purchasePanelV"/>
                                <p:ajax event="select" update="purchaseForm:cPTabs:purchasePanelV"/>
                                <f:selectItem itemValue="Készpénz" itemLabel="Készpénz"/>
                                <f:selectItem itemValue="Átutalás" itemLabel="Átutalás"/>
                            </p:selectOneMenu><br/>

                        </p:divider>
                        <p:divider>
                            <p:outputLabel for="serial" value="Felvásárlási jegy sorszáma:"/><br/>
                            <p:inputText id="serial" value="#{completedPurchaseController.dto.newSerial}" tabindex="5"
                                         inputmode="text"><p:ajax event="keyup" update="purchaseForm:cPTabs:purchasePanelV"/> </p:inputText> <br/>
                            <p:outputLabel for="receiptDate" value="Felvásárlási jegy dátuma:"/><br/>
                            <p:inputMask mask="9999.99.99" id="receiptDate" tabindex="6"
                                         value="#{completedPurchaseController.dto.receiptDate}"><p/>
                                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
                                <p:ajax event="keyup" update="purchaseForm:cPTabs:purchasePanelV"/>
                            </p:inputMask>
                            <p:outputLabel for="paymentDate" value="Fizetés dátuma:"/><br/>
                            <p:inputMask mask="9999.99.99" id="paymentDate" tabindex="7"
                                         value="#{completedPurchaseController.dto.paymentDate}"><p/>
                                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
                                <p:ajax event="keyup" update="purchaseForm:cPTabs:purchasePanelV"/>
                            </p:inputMask>

                        </p:divider>

                    </p:panelGrid>

                </div>

                <div title="Termelői adatok">
                    <table border="1" style="border-collapse: collapse">
                        <tr>
                            <td><p:outputLabel value="Termelő neve: "/></td>
                            <td><p:outputLabel id="v1" value="#{completedPurchaseController.dto.vendor.vendorName}"/>
                            </td>
                            <td><p:outputLabel value="Anyja neve: "/></td>
                            <td><p:outputLabel id="v2" value="#{completedPurchaseController.dto.vendor.nameOfMother}"/>
                            </td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Leánykori: "/></td>
                            <td><p:outputLabel id="v3" value="#{completedPurchaseController.dto.vendor.birthName}"/>
                            </td>
                            <td><p:outputLabel value="TAJ: "/></td>
                            <td><p:outputLabel id="v4" value="#{completedPurchaseController.dto.vendor.taj}"/></td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Lakcíme: "/></td>
                            <td><p:outputLabel id="v5"
                                               value="#{completedPurchaseController.dto.vendor.city}, #{completedPurchaseController.dto.vendor.address}"/>
                            </td>
                            <td><p:outputLabel value="ÖCSG: "/></td>
                            <td><p:outputLabel id="v6" value="#{completedPurchaseController.dto.vendor.fileNumber}"/>
                            </td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="FELIR: "/></td>
                            <td><p:outputLabel id="v7" value="#{completedPurchaseController.dto.vendor.felir}"/></td>
                            <td><p:outputLabel value="GGN: "/></td>
                            <td><p:outputLabel id="v8" value="#{completedPurchaseController.dto.vendor.ggn}"/></td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Adóaz.jel: "/></td>
                            <td><p:outputLabel id="v9" value="#{completedPurchaseController.dto.vendor.taxId}"/></td>
                            <td><p:outputLabel value="Telefon: "/></td>
                            <td><p:outputLabel id="v10" value="#{completedPurchaseController.dto.vendor.phone}"/></td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Adószáma: "/></td>
                            <td><p:outputLabel id="v11" value="#{completedPurchaseController.dto.vendor.taxNumber}"/>
                            </td>
                            <td><p:outputLabel value="Számlaszáma: "/></td>
                            <td><p:outputLabel id="v12"
                                               value="#{completedPurchaseController.dto.vendor.accountNumber}"/></td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Születési ideje: "/></td>
                            <td><p:outputLabel id="v13" value="#{completedPurchaseController.dto.vendor.birthDate}">
                                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
                            </p:outputLabel></td>

                            <td><p:outputLabel value="SZERZ: "/></td>
                            <td><p:outputLabel id="v14" value="#{completedPurchaseController.dto.vendor.contract}"/>
                            </td>
                        </tr>
                        <tr>
                            <td><p:outputLabel value="Születési helye: "/></td>
                            <td><p:outputLabel id="v15" value="#{completedPurchaseController.dto.vendor.birthPlace}"/>
                            </td>
                            <td><p:outputLabel value="NEBIH: "/></td>
                            <td><p:outputLabel id="v16" value="#{completedPurchaseController.dto.vendor.activity}"/>
                            </td>
                        </tr>
                    </table>


                </div>
            </p:panel>
            <p:panel header="Termékek" id="fixProductPanel" toggleable="true" collapsed="false">

                <table border="1px" style="border-collapse: collapse; overflow-x: scroll; scroll-behavior: smooth;">
                    <thead>
                    <tr>
                        <th>
                            <p:outputLabel value="Minősítés:"/>
                            <p/>
                        </th>
                        <th>
                            <p:outputLabel value="Egységár:"/>
                            <p/>
                        </th>
                        <th>
                            <p:outputLabel value="Mérlegelhető mennyiség:"/><br/>
                        </th>
                        <th>
                            <p:outputLabel value="Súly(kg):"/><br/>
                        </th>
                        <th>
                            <p:outputLabel value="Kifizetendő bruttó:"/><br/>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><p:outputLabel id="prod1"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(0).product.id}"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice1"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(0).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant1"
                                           value="#{completedPurchaseController.getMaxQuantOf(0)}"/><br/>
                        </td>
                        <td><p:inputText id="nquantity1" value="#{completedPurchaseController.quantities.get(0).num}"
                                         required="false" tabindex="8">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg price1 "/>
                        </p:inputText><br/></td>


                        <td align="center">
                            <p:outputLabel id="price1" value="#{completedPurchaseController.getFormattedPriceOf(0)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel id="prod2"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(1).product.id}"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice2"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(1).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant2"
                                           value="#{completedPurchaseController.getMaxQuantOf(1)}"/>
                            <br/></td>
                        <td><p:inputText id="nquantity2" value="#{completedPurchaseController.quantities.get(1).num}"
                                         required="false" tabindex="9">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg  price2"/>
                        </p:inputText><br/></td>
                        <td align="center">
                            <p:outputLabel id="price2" value="#{completedPurchaseController.getFormattedPriceOf(1)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel id="prod3"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(2).product.id}"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice3"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(2).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant3"
                                           value="#{completedPurchaseController.getMaxQuantOf(2)}"/><br/>
                        </td>
                        <td><p:inputText id="nquantity3" value="#{completedPurchaseController.quantities.get(2).num}"
                                         required="false" tabindex="10">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg  price3"/>
                        </p:inputText><br/></td>
                        <td align="center">
                            <p:outputLabel id="price3" value="#{completedPurchaseController.getFormattedPriceOf(2)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel id="prod4"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(3).product.id}"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice4"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(3).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant4"
                                           value="#{completedPurchaseController.getMaxQuantOf(3)}"/><br/>
                        </td>
                        <td><p:inputText id="nquantity4" value="#{completedPurchaseController.quantities.get(3).num}"
                                         required="false" tabindex="11">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg  price4"/>
                        </p:inputText><br/></td>
                        <td align="center">
                            <p:outputLabel id="price4" value="#{completedPurchaseController.getFormattedPriceOf(3)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel id="prod5"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(4).product.id}"/><br/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice5"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(4).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant5"
                                           value="#{completedPurchaseController.getMaxQuantOf(4)}"/><br/>
                        </td>

                        <td><p:inputText id="nquantity5" value="#{completedPurchaseController.quantities.get(4).num}"
                                         required="false" tabindex="12">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg  price5"/>
                        </p:inputText><br/></td>
                        <td align="center">
                            <p:outputLabel id="price5" value="#{completedPurchaseController.getFormattedPriceOf(4)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel id="prod6"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(5).product.id}"/>
                        </td>
                        <td>
                            <p:outputLabel id="vprice6"
                                           value="#{completedPurchaseController.purchaseDTO.productList.get(5).unitPrice}"/>
                        </td>
                        <td><p:outputLabel id="maxQuant6"
                                           value="#{completedPurchaseController.getMaxQuantOf(5)}"/><br/>
                        </td>
                        <td><p:inputText id="nquantity6" value="#{completedPurchaseController.quantities.get(5).num}"
                                         required="false" tabindex="13">
                            <p:ajax event="keyup"
                                    update="totalPricePerProduct1 totalNet netAvgPrice diff grossAvgPrice grossTotal netAvg  price6"/>
                        </p:inputText><br/></td>
                        <td align="center">
                            <p:outputLabel id="price6" value="#{completedPurchaseController.getFormattedPriceOf(5)}Ft"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel value="Összesen:"/></td>
                        <td colspan="2"></td>
                        <td align="center"><p:outputLabel style="font-size: 1.5em" id="totalNet"
                                                          value="#{ completedPurchaseController.getNetSum()} kg"/></td>
                        <td align="center"><p:outputLabel style="font-size: 1.5em" id="totalPricePerProduct1"
                                                          value="#{completedPurchaseController.getFormattedSixTotal()} HUF"/>
                        </td>
                    </tr>

                    <tr>
                        <td><p:outputLabel value="Átlagár br."/></td>

                        <td align="center"><p:outputLabel style="font-size: 1em" id="netAvgPrice"
                                                          value="&nbsp;&nbsp;&nbsp;#{completedPurchaseController.getFormattedNumber(completedPurchaseController.netTotal)}&nbsp;&nbsp;&nbsp;"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="diff"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.diff)}"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="grossAvgPrice"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.getGrossAvgPrice())}"/>
                        </td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="grossTotal"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.grossTotal)}"/>
                        </td>
                    </tr>
                    <tr>
                        <td><p:outputLabel value="Átlagár net."/></td>
                        <td></td>
                        <td></td>
                        <td align="center"><p:outputLabel style="font-size: 1em" id="netAvg"
                                                          value="#{ completedPurchaseController.getFormattedNumber(completedPurchaseController.netAvgPrice)}"/>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <p/>
            </p:panel>


            <p:messages id="messages" showDetail="true" closable="true">
                <p:autoUpdate/>
            </p:messages>
            <p:panel id="buttonPanel">
                <h:commandButton value="Hozzáadás"
                                 action="#{completedPurchaseController.addRecord()}"
                                 style="width: 10em;height: 2.6em">

                    <f:ajax execute="purchaseForm:cPTabs:fixProdcutPanel"
                            render="purchaseList purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2  pur"/>
                </h:commandButton>

                <h:commandButton value="Utolsó törlése"
                                 action="#{completedPurchaseController.removeRecord()}"
                                 style="width: 10em;height: 2.6em">

                    <f:ajax execute="purchaseForm:cPTabs:fixProdcutPanel"
                            render="purchaseList purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2 pur"/>
                </h:commandButton>
            </p:panel>
            <p:dataTable var="record" value="#{completedPurchaseController.tempRecords}" id="recordList"
                         lazy="false" tableStyle="width: auto"
                         style="overflow-x: scroll; margin-bottom: 5em"
                         emptyMessage="Nincs rekord" resizableColumns="true">

                <p:column headerText="Mérlegelés sorszáma">
                    <h:outputText value="#{record.purchaseId}" id="record_id"/>
                </p:column>
                <p:column headerText="Ár">
                    <h:outputText value="#{record.formattedPrice} HUF"/>
                </p:column>
                <p:column headerText="I.OSZT">
                    <h:outputText value="#{record.one}"/>
                </p:column>
                <p:column headerText="II.OSZT">
                    <h:outputText value="#{record.two}"/>
                </p:column>
                <p:column headerText="III.OSZT">
                    <h:outputText value="#{record.three}"/>
                </p:column>
                <p:column headerText="IV.OSZT">
                    <h:outputText value="#{record.four}"/>
                </p:column>
                <p:column headerText="GYÖKÉR">
                    <h:outputText value="#{record.five}"/>
                </p:column>
                <p:column headerText="IPARI">
                    <h:outputText value="#{record.six}"/>
                </p:column>
            </p:dataTable>
            <p:panel id="buttonPanel9">
                <h:commandButton value="Mentés"
                                 action="#{completedPurchaseController.uiSaveCompletedPurchase()}"
                                 style="width: 10em;height: 2.6em">

                    <f:ajax execute="purchaseForm:cPTabs:purchasePanel purchaseForm:cPTabs:purchasePanelV"
                            render="purchaseList purchasePanel purchaseForm:cPTabs:purchasePanelV  purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2 purchaseForm:cPTabs:pur"/>
                </h:commandButton>

                <h:commandButton value="Új"
                                 action="#{completedPurchaseController.newPurchase}"
                                 style="width: 10em;height: 2.6em">
                    <f:ajax execute="purchaseForm:cPTabs:purchasePanel purchaseForm:cPTabs:purchasePanelV"
                            render="purchaseList purchasePanel purchaseForm:cPTabs:purchasePanelV  purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2 purchaseForm:cPTabs:pur"/>
                </h:commandButton>
                <h:commandButton value="Töröl"
                                 action="#{completedPurchaseController.deletePurchase}"
                                 style="width: 10em;height: 2.6em">
                    <f:ajax execute="purchaseForm:cPTabs:PurchasePanel purchaseForm:cPTabs:purchasePanelV"
                            render="purchaseList purchasePanel purchaseForm:cPTabs:purchasePanelV  purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2  purchaseForm:cPTabs:pur"/>
                </h:commandButton>
                <p/>

            </p:panel>
        </p:tab>
    </p:tabView>

    <p:dataTable var="purchase" value="#{completedPurchaseController.dtoList}" id="purchaseList"
                 tableStyle="width: auto"
                 lazy="false" sortBy="#{completedPurchaseController.sortBy}" sortMode="single"
                 allowUnsorting="true" style="overflow-x: scroll; margin-bottom: 5em"
                 selectionMode="single" emptyMessage="Nincs találat" resizableColumns="true"
                 selection="#{completedPurchaseController.dto}" rowKey="#{purchase.id}">
        <p:ajax event="rowSelect" listener="#{completedPurchaseController.editPurchase}"
                update="purchaseForm:cPTabs:purchasePanel purchaseForm:cPTabs:purchasePanelV purchaseForm:cPTabs:cPPanel purchaseForm:cPTabs:fixProductPanel purchaseForm:cPTabs:recordList purchaseForm:cPTabs:recordList2 purchaseForm:cPTabs:pur"/>
        <p:column headerText="ID" sortBy="#{purchase.id}" filterBy="#{purchase.id}" filterMatchMode="contains"
        >
            <h:outputText value="#{purchase.id}" id="id"/>
        </p:column>
        <p:column headerText="Sorszám" sortBy="#{purchase.newSerial}" filterBy="#{purchase.newSerial}"
                  filterMatchMode="contains"
        >
            <h:outputText value="#{purchase.newSerial}"/>
        </p:column>
        <p:column headerText="Termelő neve" sortBy="#{purchase.vendor.vendorName}"
                  filterBy="#{purchase.vendor.vendorName}" filterMatchMode="contains">
            <h:outputText value="#{purchase.vendor.vendorName}"/>
        </p:column>
        <p:column headerText="Születési ideje:" sortBy="#{purchase.vendor.birthDate}"
                  filterBy="#{completedPurchaseController.toDottedDate(purchase.vendor.birthDate)}"
                  filterMatchMode="contains">
            <h:outputText value="#{purchase.vendor.birthDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Telephely" sortBy="#{purchase.site.siteName}" filterBy="#{purchase.site.siteName}"
                  filterMatchMode="contains">
            <h:outputText value="#{purchase.site.siteName}"/>
        </p:column>
        <p:column headerText="Fizetési Mód" sortBy="#{purchase.paymentMethod}" filterBy="#{purchase.paymentMethod}"
                  filterMatchMode="contains">
            <h:outputText value="#{purchase.paymentMethod}"/>
        </p:column>
        <p:column headerText="Vételár" sortBy="#{purchase.totalPrice}" filterBy="#{purchase.intedTotalPrice}"
                  filterMatchMode="startsWith">
            <h:outputText value="#{purchase.getFormattedTotalPrice()} HUF"/>
        </p:column>
        <p:column headerText="Fiz. dátum" sortBy="#{purchase.paymentDate}"
                  filterBy="#{completedPurchaseController.toDottedDate(purchase.paymentDate)}"
                  filterMatchMode="contains">
            <h:outputText value="#{purchase.paymentDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
        <p:column headerText="Felv.jegy dátuma" sortBy="#{purchase.receiptDate}"
                  filterBy="#{completedPurchaseController.toDottedDate(purchase.receiptDate)}"
                  filterMatchMode="contains">
            <h:outputText value="#{purchase.receiptDate}">
                <f:convertDateTime pattern="yyyy.MM.dd" timeZone="GMT+1"/>
            </h:outputText>
        </p:column>
    </p:dataTable>
</h:form>
</html>




